{"version":3,"file":"CanvasRenderer-Cj2FNQrp.js","sources":["../../node_modules/pixi.js/lib/rendering/renderers/canvas/utils/canUseNewCanvasBlendModes.mjs","../../node_modules/pixi.js/lib/rendering/renderers/canvas/utils/canvasUtils.mjs","../../node_modules/pixi.js/lib/rendering/batcher/canvas/CanvasBatchAdaptor.mjs","../../node_modules/pixi.js/lib/rendering/mask/color/CanvasColorMaskPipe.mjs","../../node_modules/pixi.js/lib/rendering/mask/stencil/CanvasStencilMaskPipe.mjs","../../node_modules/pixi.js/lib/rendering/renderers/canvas/utils/mapCanvasBlendModesToPixi.mjs","../../node_modules/pixi.js/lib/rendering/renderers/canvas/CanvasContextSystem.mjs","../../node_modules/pixi.js/lib/rendering/renderers/canvas/CanvasLimitsSystem.mjs","../../node_modules/pixi.js/lib/scene/graphics/canvas/CanvasGraphicsAdaptor.mjs","../../node_modules/pixi.js/lib/rendering/renderers/canvas/renderTarget/CanvasRenderTargetAdaptor.mjs","../../node_modules/pixi.js/lib/rendering/renderers/canvas/renderTarget/CanvasRenderTargetSystem.mjs","../../node_modules/pixi.js/lib/rendering/renderers/canvas/texture/CanvasTextureSystem.mjs","../../node_modules/pixi.js/lib/rendering/renderers/canvas/CanvasRenderer.mjs"],"sourcesContent":["import { DOMAdapter } from '../../../../environment/adapter.mjs';\n\n\"use strict\";\nlet canUseNewCanvasBlendModesValue;\nfunction createColoredCanvas(color) {\n  const canvas = DOMAdapter.get().createCanvas(6, 1);\n  const context = canvas.getContext(\"2d\");\n  context.fillStyle = color;\n  context.fillRect(0, 0, 6, 1);\n  return canvas;\n}\nfunction canUseNewCanvasBlendModes() {\n  if (canUseNewCanvasBlendModesValue !== void 0) {\n    return canUseNewCanvasBlendModesValue;\n  }\n  try {\n    const magenta = createColoredCanvas(\"#ff00ff\");\n    const yellow = createColoredCanvas(\"#ffff00\");\n    const canvas = DOMAdapter.get().createCanvas(6, 1);\n    const context = canvas.getContext(\"2d\");\n    context.globalCompositeOperation = \"multiply\";\n    context.drawImage(magenta, 0, 0);\n    context.drawImage(yellow, 2, 0);\n    const imageData = context.getImageData(2, 0, 1, 1);\n    if (!imageData) {\n      canUseNewCanvasBlendModesValue = false;\n    } else {\n      const data = imageData.data;\n      canUseNewCanvasBlendModesValue = data[0] === 255 && data[1] === 0 && data[2] === 0;\n    }\n  } catch (_error) {\n    canUseNewCanvasBlendModesValue = false;\n  }\n  return canUseNewCanvasBlendModesValue;\n}\n\nexport { canUseNewCanvasBlendModes };\n//# sourceMappingURL=canUseNewCanvasBlendModes.mjs.map\n","import { Color } from '../../../../color/Color.mjs';\nimport { DOMAdapter } from '../../../../environment/adapter.mjs';\nimport { groupD8 } from '../../../../maths/matrix/groupD8.mjs';\nimport { canUseNewCanvasBlendModes } from './canUseNewCanvasBlendModes.mjs';\n\n\"use strict\";\nconst canvasUtils = {\n  canvas: null,\n  convertTintToImage: false,\n  cacheStepsPerColorChannel: 8,\n  canUseMultiply: canUseNewCanvasBlendModes(),\n  tintMethod: null,\n  _canvasSourceCache: /* @__PURE__ */ new WeakMap(),\n  _unpremultipliedCache: /* @__PURE__ */ new WeakMap(),\n  getCanvasSource: (texture) => {\n    const source = texture.source;\n    const resource = source?.resource;\n    if (!resource) {\n      return null;\n    }\n    const isPMA = source.alphaMode === \"premultiplied-alpha\";\n    const resourceWidth = source.resourceWidth ?? source.pixelWidth;\n    const resourceHeight = source.resourceHeight ?? source.pixelHeight;\n    const needsResize = resourceWidth !== source.pixelWidth || resourceHeight !== source.pixelHeight;\n    if (isPMA) {\n      if (resource instanceof HTMLCanvasElement || typeof OffscreenCanvas !== \"undefined\" && resource instanceof OffscreenCanvas) {\n        if (!needsResize) {\n          return resource;\n        }\n      }\n      const cached = canvasUtils._unpremultipliedCache.get(source);\n      if (cached?.resourceId === source._resourceId) {\n        return cached.canvas;\n      }\n    }\n    if (resource instanceof Uint8Array || resource instanceof Uint8ClampedArray || resource instanceof Int8Array || resource instanceof Uint16Array || resource instanceof Int16Array || resource instanceof Uint32Array || resource instanceof Int32Array || resource instanceof Float32Array || resource instanceof ArrayBuffer) {\n      const cached = canvasUtils._canvasSourceCache.get(source);\n      if (cached?.resourceId === source._resourceId) {\n        return cached.canvas;\n      }\n      const canvas = DOMAdapter.get().createCanvas(source.pixelWidth, source.pixelHeight);\n      const context = canvas.getContext(\"2d\");\n      const imageData = context.createImageData(source.pixelWidth, source.pixelHeight);\n      const data = imageData.data;\n      const bytes = resource instanceof ArrayBuffer ? new Uint8Array(resource) : new Uint8Array(resource.buffer, resource.byteOffset, resource.byteLength);\n      if (source.format === \"bgra8unorm\") {\n        for (let i = 0; i < data.length && i + 3 < bytes.length; i += 4) {\n          data[i] = bytes[i + 2];\n          data[i + 1] = bytes[i + 1];\n          data[i + 2] = bytes[i];\n          data[i + 3] = bytes[i + 3];\n        }\n      } else {\n        data.set(bytes.subarray(0, data.length));\n      }\n      context.putImageData(imageData, 0, 0);\n      canvasUtils._canvasSourceCache.set(source, { canvas, resourceId: source._resourceId });\n      return canvas;\n    }\n    if (isPMA) {\n      const canvas = DOMAdapter.get().createCanvas(source.pixelWidth, source.pixelHeight);\n      const context = canvas.getContext(\"2d\", { willReadFrequently: true });\n      canvas.width = source.pixelWidth;\n      canvas.height = source.pixelHeight;\n      context.drawImage(resource, 0, 0);\n      const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n      const data = imageData.data;\n      for (let i = 0; i < data.length; i += 4) {\n        const a = data[i + 3];\n        if (a > 0) {\n          const alphaInv = 255 / a;\n          data[i] = Math.min(255, data[i] * alphaInv + 0.5);\n          data[i + 1] = Math.min(255, data[i + 1] * alphaInv + 0.5);\n          data[i + 2] = Math.min(255, data[i + 2] * alphaInv + 0.5);\n        }\n      }\n      context.putImageData(imageData, 0, 0);\n      canvasUtils._unpremultipliedCache.set(source, { canvas, resourceId: source._resourceId });\n      return canvas;\n    }\n    if (needsResize) {\n      const cached = canvasUtils._canvasSourceCache.get(source);\n      if (cached?.resourceId === source._resourceId) {\n        return cached.canvas;\n      }\n      const canvas = DOMAdapter.get().createCanvas(source.pixelWidth, source.pixelHeight);\n      const context = canvas.getContext(\"2d\");\n      canvas.width = source.pixelWidth;\n      canvas.height = source.pixelHeight;\n      context.drawImage(resource, 0, 0);\n      canvasUtils._canvasSourceCache.set(source, { canvas, resourceId: source._resourceId });\n      return canvas;\n    }\n    return resource;\n  },\n  getTintedCanvas: (sprite, color) => {\n    const texture = sprite.texture;\n    const stringColor = Color.shared.setValue(color).toHex();\n    const cache = texture.tintCache || (texture.tintCache = {});\n    const cachedCanvas = cache[stringColor];\n    const resourceId = texture.source._resourceId;\n    if (cachedCanvas?.tintId === resourceId) {\n      return cachedCanvas;\n    }\n    const canvas = cachedCanvas && \"getContext\" in cachedCanvas ? cachedCanvas : DOMAdapter.get().createCanvas();\n    canvasUtils.tintMethod(texture, color, canvas);\n    canvas.tintId = resourceId;\n    if (canvasUtils.convertTintToImage && canvas.toDataURL !== void 0) {\n      const tintImage = DOMAdapter.get().createImage();\n      tintImage.src = canvas.toDataURL();\n      tintImage.tintId = resourceId;\n      cache[stringColor] = tintImage;\n    } else {\n      cache[stringColor] = canvas;\n    }\n    return cache[stringColor];\n  },\n  getTintedPattern: (texture, color) => {\n    const stringColor = Color.shared.setValue(color).toHex();\n    const cache = texture.patternCache || (texture.patternCache = {});\n    const resourceId = texture.source._resourceId;\n    let pattern = cache[stringColor];\n    if (pattern?.tintId === resourceId) {\n      return pattern;\n    }\n    if (!canvasUtils.canvas) {\n      canvasUtils.canvas = DOMAdapter.get().createCanvas();\n    }\n    canvasUtils.tintMethod(texture, color, canvasUtils.canvas);\n    const context = canvasUtils.canvas.getContext(\"2d\");\n    pattern = context.createPattern(canvasUtils.canvas, \"repeat\");\n    pattern.tintId = resourceId;\n    cache[stringColor] = pattern;\n    return pattern;\n  },\n  /**\n   * Applies a transform to a CanvasPattern.\n   * @param pattern - The pattern to apply the transform to.\n   * @param matrix - The matrix to apply.\n   * @param matrix.a\n   * @param matrix.b\n   * @param matrix.c\n   * @param matrix.d\n   * @param matrix.tx\n   * @param matrix.ty\n   * @param invert\n   */\n  applyPatternTransform: (pattern, matrix, invert = true) => {\n    if (!matrix) return;\n    const patternAny = pattern;\n    if (!patternAny.setTransform) return;\n    const DOMMatrixCtor = globalThis.DOMMatrix;\n    if (!DOMMatrixCtor) return;\n    const domMatrix = new DOMMatrixCtor([matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty]);\n    patternAny.setTransform(invert ? domMatrix.inverse() : domMatrix);\n  },\n  tintWithMultiply: (texture, color, canvas) => {\n    const context = canvas.getContext(\"2d\");\n    const crop = texture.frame.clone();\n    const resolution = texture.source._resolution ?? texture.source.resolution ?? 1;\n    const rotate = texture.rotate;\n    crop.x *= resolution;\n    crop.y *= resolution;\n    crop.width *= resolution;\n    crop.height *= resolution;\n    const isVertical = groupD8.isVertical(rotate);\n    const outWidth = isVertical ? crop.height : crop.width;\n    const outHeight = isVertical ? crop.width : crop.height;\n    canvas.width = Math.ceil(outWidth);\n    canvas.height = Math.ceil(outHeight);\n    context.save();\n    context.fillStyle = Color.shared.setValue(color).toHex();\n    context.fillRect(0, 0, outWidth, outHeight);\n    context.globalCompositeOperation = \"multiply\";\n    const source = canvasUtils.getCanvasSource(texture);\n    if (!source) {\n      context.restore();\n      return;\n    }\n    if (rotate) {\n      canvasUtils._applyInverseRotation(context, rotate, crop.width, crop.height);\n    }\n    context.drawImage(\n      source,\n      crop.x,\n      crop.y,\n      crop.width,\n      crop.height,\n      0,\n      0,\n      crop.width,\n      crop.height\n    );\n    context.globalCompositeOperation = \"destination-atop\";\n    context.drawImage(\n      source,\n      crop.x,\n      crop.y,\n      crop.width,\n      crop.height,\n      0,\n      0,\n      crop.width,\n      crop.height\n    );\n    context.restore();\n  },\n  tintWithOverlay: (texture, color, canvas) => {\n    const context = canvas.getContext(\"2d\");\n    const crop = texture.frame.clone();\n    const resolution = texture.source._resolution ?? texture.source.resolution ?? 1;\n    const rotate = texture.rotate;\n    crop.x *= resolution;\n    crop.y *= resolution;\n    crop.width *= resolution;\n    crop.height *= resolution;\n    const isVertical = groupD8.isVertical(rotate);\n    const outWidth = isVertical ? crop.height : crop.width;\n    const outHeight = isVertical ? crop.width : crop.height;\n    canvas.width = Math.ceil(outWidth);\n    canvas.height = Math.ceil(outHeight);\n    context.save();\n    context.globalCompositeOperation = \"copy\";\n    context.fillStyle = Color.shared.setValue(color).toHex();\n    context.fillRect(0, 0, outWidth, outHeight);\n    context.globalCompositeOperation = \"destination-atop\";\n    const source = canvasUtils.getCanvasSource(texture);\n    if (!source) {\n      context.restore();\n      return;\n    }\n    if (rotate) {\n      canvasUtils._applyInverseRotation(context, rotate, crop.width, crop.height);\n    }\n    context.drawImage(\n      source,\n      crop.x,\n      crop.y,\n      crop.width,\n      crop.height,\n      0,\n      0,\n      crop.width,\n      crop.height\n    );\n    context.restore();\n  },\n  tintWithPerPixel: (texture, color, canvas) => {\n    const context = canvas.getContext(\"2d\");\n    const crop = texture.frame.clone();\n    const resolution = texture.source._resolution ?? texture.source.resolution ?? 1;\n    const rotate = texture.rotate;\n    crop.x *= resolution;\n    crop.y *= resolution;\n    crop.width *= resolution;\n    crop.height *= resolution;\n    const isVertical = groupD8.isVertical(rotate);\n    const outWidth = isVertical ? crop.height : crop.width;\n    const outHeight = isVertical ? crop.width : crop.height;\n    canvas.width = Math.ceil(outWidth);\n    canvas.height = Math.ceil(outHeight);\n    context.save();\n    context.globalCompositeOperation = \"copy\";\n    const source = canvasUtils.getCanvasSource(texture);\n    if (!source) {\n      context.restore();\n      return;\n    }\n    if (rotate) {\n      canvasUtils._applyInverseRotation(context, rotate, crop.width, crop.height);\n    }\n    context.drawImage(\n      source,\n      crop.x,\n      crop.y,\n      crop.width,\n      crop.height,\n      0,\n      0,\n      crop.width,\n      crop.height\n    );\n    context.restore();\n    const r = color >> 16 & 255;\n    const g = color >> 8 & 255;\n    const b = color & 255;\n    const imageData = context.getImageData(0, 0, outWidth, outHeight);\n    const data = imageData.data;\n    for (let i = 0; i < data.length; i += 4) {\n      data[i] = data[i] * r / 255;\n      data[i + 1] = data[i + 1] * g / 255;\n      data[i + 2] = data[i + 2] * b / 255;\n    }\n    context.putImageData(imageData, 0, 0);\n  },\n  /**\n   * Applies inverse rotation transform to context for texture packer rotation compensation.\n   * Supports all 16 groupD8 symmetries (rotations and reflections).\n   * @param context - Canvas 2D context\n   * @param rotate - The groupD8 rotation value\n   * @param srcWidth - Source crop width (before rotation)\n   * @param srcHeight - Source crop height (before rotation)\n   */\n  _applyInverseRotation: (context, rotate, srcWidth, srcHeight) => {\n    const inv = groupD8.inv(rotate);\n    const a = groupD8.uX(inv);\n    const b = groupD8.uY(inv);\n    const c = groupD8.vX(inv);\n    const d = groupD8.vY(inv);\n    const tx = -Math.min(0, a * srcWidth, c * srcHeight, a * srcWidth + c * srcHeight);\n    const ty = -Math.min(0, b * srcWidth, d * srcHeight, b * srcWidth + d * srcHeight);\n    context.transform(a, b, c, d, tx, ty);\n  }\n};\ncanvasUtils.tintMethod = canvasUtils.canUseMultiply ? canvasUtils.tintWithMultiply : canvasUtils.tintWithPerPixel;\n\nexport { canvasUtils };\n//# sourceMappingURL=canvasUtils.mjs.map\n","import { ExtensionType } from '../../../extensions/Extensions.mjs';\nimport { groupD8 } from '../../../maths/matrix/groupD8.mjs';\nimport { Matrix } from '../../../maths/matrix/Matrix.mjs';\nimport { bgr2rgb } from '../../../scene/container/container-mixins/getGlobalMixin.mjs';\nimport { multiplyHexColors } from '../../../scene/container/utils/multiplyHexColors.mjs';\nimport { canvasUtils } from '../../renderers/canvas/utils/canvasUtils.mjs';\n\n\"use strict\";\nconst _CanvasBatchAdaptor = class _CanvasBatchAdaptor {\n  static _getPatternRepeat(addressModeU, addressModeV) {\n    const repeatU = addressModeU && addressModeU !== \"clamp-to-edge\";\n    const repeatV = addressModeV && addressModeV !== \"clamp-to-edge\";\n    if (repeatU && repeatV) return \"repeat\";\n    if (repeatU) return \"repeat-x\";\n    if (repeatV) return \"repeat-y\";\n    return \"no-repeat\";\n  }\n  start(batchPipe, geometry, shader) {\n    void batchPipe;\n    void geometry;\n    void shader;\n  }\n  execute(batchPipe, batch) {\n    const elements = batch.elements;\n    if (!elements || !elements.length) return;\n    const renderer = batchPipe.renderer;\n    const contextSystem = renderer.canvasContext;\n    const context = contextSystem.activeContext;\n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i];\n      if (!element.packAsQuad) continue;\n      const quad = element;\n      const texture = quad.texture;\n      const source = texture ? canvasUtils.getCanvasSource(texture) : null;\n      if (!source) continue;\n      const textureStyle = texture.source.style;\n      const smoothProperty = contextSystem.smoothProperty;\n      const shouldSmooth = textureStyle.scaleMode !== \"nearest\";\n      if (context[smoothProperty] !== shouldSmooth) {\n        context[smoothProperty] = shouldSmooth;\n      }\n      contextSystem.setBlendMode(batch.blendMode);\n      const globalColor = renderer.globalUniforms.globalUniformData?.worldColor ?? 4294967295;\n      const argb = quad.color;\n      const globalAlpha = (globalColor >>> 24 & 255) / 255;\n      const quadAlpha = (argb >>> 24 & 255) / 255;\n      const filterAlpha = renderer.filter?.alphaMultiplier ?? 1;\n      const alpha = globalAlpha * quadAlpha * filterAlpha;\n      if (alpha <= 0) continue;\n      context.globalAlpha = alpha;\n      const globalTint = globalColor & 16777215;\n      const quadTint = argb & 16777215;\n      const tint = bgr2rgb(multiplyHexColors(quadTint, globalTint));\n      const frame = texture.frame;\n      const repeatU = textureStyle.addressModeU ?? textureStyle.addressMode;\n      const repeatV = textureStyle.addressModeV ?? textureStyle.addressMode;\n      const repeat = _CanvasBatchAdaptor._getPatternRepeat(repeatU, repeatV);\n      const resolution = texture.source._resolution ?? texture.source.resolution ?? 1;\n      const isFromCachedRenderGroup = quad.renderable?.renderGroup?.isCachedAsTexture;\n      const sx = frame.x * resolution;\n      const sy = frame.y * resolution;\n      const sw = frame.width * resolution;\n      const sh = frame.height * resolution;\n      const bounds = quad.bounds;\n      const isRootTarget = renderer.renderTarget.renderTarget.isRoot;\n      const dx = bounds.minX;\n      const dy = bounds.minY;\n      const dw = bounds.maxX - bounds.minX;\n      const dh = bounds.maxY - bounds.minY;\n      const rotate = texture.rotate;\n      const uvs = texture.uvs;\n      const uvMin = Math.min(uvs.x0, uvs.x1, uvs.x2, uvs.x3, uvs.y0, uvs.y1, uvs.y2, uvs.y3);\n      const uvMax = Math.max(uvs.x0, uvs.x1, uvs.x2, uvs.x3, uvs.y0, uvs.y1, uvs.y2, uvs.y3);\n      const needsRepeat = repeat !== \"no-repeat\" && (uvMin < 0 || uvMax > 1);\n      const willUseProcessedCanvas = !needsRepeat && (tint !== 16777215 || rotate);\n      const applyRotateTransform = rotate && !willUseProcessedCanvas;\n      if (applyRotateTransform) {\n        _CanvasBatchAdaptor._tempPatternMatrix.copyFrom(quad.transform);\n        groupD8.matrixAppendRotationInv(\n          _CanvasBatchAdaptor._tempPatternMatrix,\n          rotate,\n          dx,\n          dy,\n          dw,\n          dh\n        );\n        contextSystem.setContextTransform(\n          _CanvasBatchAdaptor._tempPatternMatrix,\n          quad.roundPixels === 1,\n          void 0,\n          isFromCachedRenderGroup && isRootTarget\n        );\n      } else {\n        contextSystem.setContextTransform(\n          quad.transform,\n          quad.roundPixels === 1,\n          void 0,\n          isFromCachedRenderGroup && isRootTarget\n        );\n      }\n      const drawX = applyRotateTransform ? 0 : dx;\n      const drawY = applyRotateTransform ? 0 : dy;\n      const drawW = dw;\n      const drawH = dh;\n      if (needsRepeat) {\n        let patternSource = source;\n        const canTint = tint !== 16777215 && !rotate;\n        const fitsFrame = frame.width <= texture.source.width && frame.height <= texture.source.height;\n        if (canTint && fitsFrame) {\n          patternSource = canvasUtils.getTintedCanvas({ texture }, tint);\n        }\n        const pattern = context.createPattern(patternSource, repeat);\n        if (!pattern) continue;\n        const denomX = drawW;\n        const denomY = drawH;\n        if (denomX === 0 || denomY === 0) continue;\n        const invDx = 1 / denomX;\n        const invDy = 1 / denomY;\n        const a = (uvs.x1 - uvs.x0) * invDx;\n        const b = (uvs.y1 - uvs.y0) * invDx;\n        const c = (uvs.x3 - uvs.x0) * invDy;\n        const d = (uvs.y3 - uvs.y0) * invDy;\n        const tx = uvs.x0 - a * drawX - c * drawY;\n        const ty = uvs.y0 - b * drawX - d * drawY;\n        const pixelWidth = texture.source.pixelWidth;\n        const pixelHeight = texture.source.pixelHeight;\n        _CanvasBatchAdaptor._tempPatternMatrix.set(\n          a * pixelWidth,\n          b * pixelHeight,\n          c * pixelWidth,\n          d * pixelHeight,\n          tx * pixelWidth,\n          ty * pixelHeight\n        );\n        canvasUtils.applyPatternTransform(pattern, _CanvasBatchAdaptor._tempPatternMatrix);\n        context.fillStyle = pattern;\n        context.fillRect(drawX, drawY, drawW, drawH);\n      } else {\n        const needsProcessing = tint !== 16777215 || rotate;\n        const processedSource = needsProcessing ? canvasUtils.getTintedCanvas({ texture }, tint) : source;\n        const isProcessed = processedSource !== source;\n        context.drawImage(\n          processedSource,\n          isProcessed ? 0 : sx,\n          isProcessed ? 0 : sy,\n          isProcessed ? processedSource.width : sw,\n          isProcessed ? processedSource.height : sh,\n          drawX,\n          drawY,\n          drawW,\n          drawH\n        );\n      }\n    }\n  }\n};\n_CanvasBatchAdaptor._tempPatternMatrix = new Matrix();\n/** @ignore */\n_CanvasBatchAdaptor.extension = {\n  type: [\n    ExtensionType.CanvasPipesAdaptor\n  ],\n  name: \"batch\"\n};\nlet CanvasBatchAdaptor = _CanvasBatchAdaptor;\n\nexport { CanvasBatchAdaptor };\n//# sourceMappingURL=CanvasBatchAdaptor.mjs.map\n","import { ExtensionType } from '../../../extensions/Extensions.mjs';\n\n\"use strict\";\nclass CanvasColorMaskPipe {\n  constructor(renderer) {\n    this._colorStack = [];\n    this._colorStackIndex = 0;\n    this._currentColor = 0;\n    this._renderer = renderer;\n  }\n  buildStart() {\n    this._colorStack[0] = 15;\n    this._colorStackIndex = 1;\n    this._currentColor = 15;\n  }\n  push(mask, _container, instructionSet) {\n    this._renderer.renderPipes.batch.break(instructionSet);\n    const colorStack = this._colorStack;\n    colorStack[this._colorStackIndex] = colorStack[this._colorStackIndex - 1] & mask.mask;\n    const currentColor = this._colorStack[this._colorStackIndex];\n    if (currentColor !== this._currentColor) {\n      this._currentColor = currentColor;\n      instructionSet.add({\n        renderPipeId: \"colorMask\",\n        colorMask: currentColor,\n        canBundle: false\n      });\n    }\n    this._colorStackIndex++;\n  }\n  pop(_mask, _container, instructionSet) {\n    this._renderer.renderPipes.batch.break(instructionSet);\n    const colorStack = this._colorStack;\n    this._colorStackIndex--;\n    const currentColor = colorStack[this._colorStackIndex - 1];\n    if (currentColor !== this._currentColor) {\n      this._currentColor = currentColor;\n      instructionSet.add({\n        renderPipeId: \"colorMask\",\n        colorMask: currentColor,\n        canBundle: false\n      });\n    }\n  }\n  execute(_instruction) {\n  }\n  destroy() {\n    this._renderer = null;\n    this._colorStack = null;\n  }\n}\n/** @ignore */\nCanvasColorMaskPipe.extension = {\n  type: [\n    ExtensionType.CanvasPipes\n  ],\n  name: \"colorMask\"\n};\n\nexport { CanvasColorMaskPipe };\n//# sourceMappingURL=CanvasColorMaskPipe.mjs.map\n","import { ExtensionType } from '../../../extensions/Extensions.mjs';\nimport { Graphics } from '../../../scene/graphics/shared/Graphics.mjs';\nimport { warn } from '../../../utils/logging/warn.mjs';\n\n\"use strict\";\nfunction buildRoundedRectPath(context, x, y, width, height, radius) {\n  radius = Math.max(0, Math.min(radius, Math.min(width, height) / 2));\n  context.moveTo(x + radius, y);\n  context.lineTo(x + width - radius, y);\n  context.quadraticCurveTo(x + width, y, x + width, y + radius);\n  context.lineTo(x + width, y + height - radius);\n  context.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n  context.lineTo(x + radius, y + height);\n  context.quadraticCurveTo(x, y + height, x, y + height - radius);\n  context.lineTo(x, y + radius);\n  context.quadraticCurveTo(x, y, x + radius, y);\n}\nfunction buildShapePath(context, shape) {\n  switch (shape.type) {\n    case \"rectangle\": {\n      const rect = shape;\n      context.rect(rect.x, rect.y, rect.width, rect.height);\n      break;\n    }\n    case \"roundedRectangle\": {\n      const rect = shape;\n      buildRoundedRectPath(context, rect.x, rect.y, rect.width, rect.height, rect.radius);\n      break;\n    }\n    case \"circle\": {\n      const circle = shape;\n      context.moveTo(circle.x + circle.radius, circle.y);\n      context.arc(circle.x, circle.y, circle.radius, 0, Math.PI * 2);\n      break;\n    }\n    case \"ellipse\": {\n      const ellipse = shape;\n      if (context.ellipse) {\n        context.moveTo(ellipse.x + ellipse.halfWidth, ellipse.y);\n        context.ellipse(ellipse.x, ellipse.y, ellipse.halfWidth, ellipse.halfHeight, 0, 0, Math.PI * 2);\n      } else {\n        context.save();\n        context.translate(ellipse.x, ellipse.y);\n        context.scale(ellipse.halfWidth, ellipse.halfHeight);\n        context.moveTo(1, 0);\n        context.arc(0, 0, 1, 0, Math.PI * 2);\n        context.restore();\n      }\n      break;\n    }\n    case \"triangle\": {\n      const tri = shape;\n      context.moveTo(tri.x, tri.y);\n      context.lineTo(tri.x2, tri.y2);\n      context.lineTo(tri.x3, tri.y3);\n      context.closePath();\n      break;\n    }\n    case \"polygon\":\n    default: {\n      const poly = shape;\n      const points = poly.points;\n      if (!points?.length) break;\n      context.moveTo(points[0], points[1]);\n      for (let i = 2; i < points.length; i += 2) {\n        context.lineTo(points[i], points[i + 1]);\n      }\n      if (poly.closePath) {\n        context.closePath();\n      }\n      break;\n    }\n  }\n}\nfunction addHolePaths(context, holes) {\n  if (!holes?.length) return false;\n  for (let i = 0; i < holes.length; i++) {\n    const hole = holes[i];\n    if (!hole?.shape) continue;\n    const transform = hole.transform;\n    const hasTransform = transform && !transform.isIdentity();\n    if (hasTransform) {\n      context.save();\n      context.transform(transform.a, transform.b, transform.c, transform.d, transform.tx, transform.ty);\n    }\n    buildShapePath(context, hole.shape);\n    if (hasTransform) {\n      context.restore();\n    }\n  }\n  return true;\n}\nclass CanvasStencilMaskPipe {\n  constructor(renderer) {\n    this._warnedMaskTypes = /* @__PURE__ */ new Set();\n    this._canvasMaskStack = [];\n    this._renderer = renderer;\n  }\n  push(mask, _container, instructionSet) {\n    this._renderer.renderPipes.batch.break(instructionSet);\n    instructionSet.add({\n      renderPipeId: \"stencilMask\",\n      action: \"pushMaskBegin\",\n      mask,\n      inverse: _container._maskOptions.inverse,\n      canBundle: false\n    });\n  }\n  pop(_mask, _container, instructionSet) {\n    this._renderer.renderPipes.batch.break(instructionSet);\n    instructionSet.add({\n      renderPipeId: \"stencilMask\",\n      action: \"popMaskEnd\",\n      mask: _mask,\n      inverse: _container._maskOptions.inverse,\n      canBundle: false\n    });\n  }\n  execute(instruction) {\n    if (instruction.action !== \"pushMaskBegin\" && instruction.action !== \"popMaskEnd\") {\n      return;\n    }\n    const canvasRenderer = this._renderer;\n    const contextSystem = canvasRenderer.canvasContext;\n    const context = contextSystem?.activeContext;\n    if (!context) return;\n    if (instruction.action === \"popMaskEnd\") {\n      const didClip = this._canvasMaskStack.pop();\n      if (didClip) {\n        context.restore();\n      }\n      return;\n    }\n    if (instruction.inverse) {\n      this._warnOnce(\n        \"inverse\",\n        \"CanvasRenderer: inverse masks are not supported on Canvas2D; ignoring inverse flag.\"\n      );\n    }\n    const maskContainer = instruction.mask.mask;\n    if (!(maskContainer instanceof Graphics)) {\n      this._warnOnce(\n        \"nonGraphics\",\n        \"CanvasRenderer: only Graphics masks are supported in Canvas2D; skipping mask.\"\n      );\n      this._canvasMaskStack.push(false);\n      return;\n    }\n    const graphics = maskContainer;\n    const instructions = graphics.context?.instructions;\n    if (!instructions?.length) {\n      this._canvasMaskStack.push(false);\n      return;\n    }\n    context.save();\n    contextSystem.setContextTransform(\n      graphics.groupTransform,\n      (canvasRenderer._roundPixels | graphics._roundPixels) === 1\n    );\n    context.beginPath();\n    let drewPath = false;\n    let hasHoles = false;\n    for (let i = 0; i < instructions.length; i++) {\n      const instructionData = instructions[i];\n      const action = instructionData.action;\n      if (action !== \"fill\" && action !== \"stroke\") continue;\n      const data = instructionData.data;\n      const shapePath = data?.path?.shapePath;\n      if (!shapePath?.shapePrimitives?.length) continue;\n      const shapePrimitives = shapePath.shapePrimitives;\n      for (let j = 0; j < shapePrimitives.length; j++) {\n        const primitive = shapePrimitives[j];\n        if (!primitive?.shape) continue;\n        const transform = primitive.transform;\n        const hasTransform = transform && !transform.isIdentity();\n        if (hasTransform) {\n          context.save();\n          context.transform(transform.a, transform.b, transform.c, transform.d, transform.tx, transform.ty);\n        }\n        buildShapePath(context, primitive.shape);\n        hasHoles = addHolePaths(context, primitive.holes) || hasHoles;\n        drewPath = true;\n        if (hasTransform) {\n          context.restore();\n        }\n      }\n    }\n    if (!drewPath) {\n      context.restore();\n      this._canvasMaskStack.push(false);\n      return;\n    }\n    if (hasHoles) {\n      context.clip(\"evenodd\");\n    } else {\n      context.clip();\n    }\n    this._canvasMaskStack.push(true);\n  }\n  destroy() {\n    this._renderer = null;\n    this._warnedMaskTypes = null;\n    this._canvasMaskStack = null;\n  }\n  _warnOnce(key, message) {\n    if (this._warnedMaskTypes.has(key)) return;\n    this._warnedMaskTypes.add(key);\n    warn(message);\n  }\n}\nCanvasStencilMaskPipe.extension = {\n  type: [\n    ExtensionType.CanvasPipes\n  ],\n  name: \"stencilMask\"\n};\n\nexport { CanvasStencilMaskPipe };\n//# sourceMappingURL=CanvasStencilMaskPipe.mjs.map\n","import { canUseNewCanvasBlendModes } from './canUseNewCanvasBlendModes.mjs';\n\n\"use strict\";\nconst FALLBACK_BLEND = \"source-over\";\nfunction mapCanvasBlendModesToPixi() {\n  const supportsAdvanced = canUseNewCanvasBlendModes();\n  const map = /* @__PURE__ */ Object.create(null);\n  map.inherit = FALLBACK_BLEND;\n  map.none = FALLBACK_BLEND;\n  map.normal = \"source-over\";\n  map.add = \"lighter\";\n  map.multiply = supportsAdvanced ? \"multiply\" : FALLBACK_BLEND;\n  map.screen = supportsAdvanced ? \"screen\" : FALLBACK_BLEND;\n  map.overlay = supportsAdvanced ? \"overlay\" : FALLBACK_BLEND;\n  map.darken = supportsAdvanced ? \"darken\" : FALLBACK_BLEND;\n  map.lighten = supportsAdvanced ? \"lighten\" : FALLBACK_BLEND;\n  map[\"color-dodge\"] = supportsAdvanced ? \"color-dodge\" : FALLBACK_BLEND;\n  map[\"color-burn\"] = supportsAdvanced ? \"color-burn\" : FALLBACK_BLEND;\n  map[\"hard-light\"] = supportsAdvanced ? \"hard-light\" : FALLBACK_BLEND;\n  map[\"soft-light\"] = supportsAdvanced ? \"soft-light\" : FALLBACK_BLEND;\n  map.difference = supportsAdvanced ? \"difference\" : FALLBACK_BLEND;\n  map.exclusion = supportsAdvanced ? \"exclusion\" : FALLBACK_BLEND;\n  map.saturation = supportsAdvanced ? \"saturation\" : FALLBACK_BLEND;\n  map.color = supportsAdvanced ? \"color\" : FALLBACK_BLEND;\n  map.luminosity = supportsAdvanced ? \"luminosity\" : FALLBACK_BLEND;\n  map[\"linear-burn\"] = supportsAdvanced ? \"color-burn\" : FALLBACK_BLEND;\n  map[\"linear-dodge\"] = supportsAdvanced ? \"color-dodge\" : FALLBACK_BLEND;\n  map[\"linear-light\"] = supportsAdvanced ? \"hard-light\" : FALLBACK_BLEND;\n  map[\"pin-light\"] = supportsAdvanced ? \"hard-light\" : FALLBACK_BLEND;\n  map[\"vivid-light\"] = supportsAdvanced ? \"hard-light\" : FALLBACK_BLEND;\n  map[\"hard-mix\"] = FALLBACK_BLEND;\n  map.negation = supportsAdvanced ? \"difference\" : FALLBACK_BLEND;\n  map[\"normal-npm\"] = map.normal;\n  map[\"add-npm\"] = map.add;\n  map[\"screen-npm\"] = map.screen;\n  map.erase = \"destination-out\";\n  map.subtract = FALLBACK_BLEND;\n  map.divide = FALLBACK_BLEND;\n  map.min = FALLBACK_BLEND;\n  map.max = FALLBACK_BLEND;\n  return map;\n}\n\nexport { mapCanvasBlendModesToPixi };\n//# sourceMappingURL=mapCanvasBlendModesToPixi.mjs.map\n","import { Color } from '../../../color/Color.mjs';\nimport { ExtensionType } from '../../../extensions/Extensions.mjs';\nimport { Matrix } from '../../../maths/matrix/Matrix.mjs';\nimport { mapCanvasBlendModesToPixi } from './utils/mapCanvasBlendModesToPixi.mjs';\n\n\"use strict\";\nconst tempMatrix = new Matrix();\nclass CanvasContextSystem {\n  /**\n   * @param renderer - The owning CanvasRenderer.\n   */\n  constructor(renderer) {\n    /** Resolution of the active context. */\n    this.activeResolution = 1;\n    /** The image smoothing property to toggle for this browser. */\n    this.smoothProperty = \"imageSmoothingEnabled\";\n    /** Map of Pixi blend modes to canvas composite operations. */\n    this.blendModes = mapCanvasBlendModesToPixi();\n    /** Current canvas blend mode. */\n    this._activeBlendMode = \"normal\";\n    /** Optional projection transform for render targets. */\n    this._projTransform = null;\n    /** True when external blend mode control is in use. */\n    this._outerBlend = false;\n    /** Tracks unsupported blend mode warnings to avoid spam. */\n    this._warnedBlendModes = /* @__PURE__ */ new Set();\n    this._renderer = renderer;\n  }\n  resolutionChange(resolution) {\n    this.activeResolution = resolution;\n  }\n  /** Initializes the root context and smoothing flag selection. */\n  init() {\n    const alpha = this._renderer.background.alpha < 1;\n    this.rootContext = this._renderer.canvas.getContext(\n      \"2d\",\n      { alpha }\n    );\n    this.activeContext = this.rootContext;\n    this.activeResolution = this._renderer.resolution;\n    if (!this.rootContext.imageSmoothingEnabled) {\n      const rc = this.rootContext;\n      if (rc.webkitImageSmoothingEnabled) {\n        this.smoothProperty = \"webkitImageSmoothingEnabled\";\n      } else if (rc.mozImageSmoothingEnabled) {\n        this.smoothProperty = \"mozImageSmoothingEnabled\";\n      } else if (rc.oImageSmoothingEnabled) {\n        this.smoothProperty = \"oImageSmoothingEnabled\";\n      } else if (rc.msImageSmoothingEnabled) {\n        this.smoothProperty = \"msImageSmoothingEnabled\";\n      }\n    }\n  }\n  /**\n   * Sets the current transform on the active context.\n   * @param transform - Transform to apply.\n   * @param roundPixels - Whether to round translation to integers.\n   * @param localResolution - Optional local resolution multiplier.\n   * @param skipGlobalTransform - If true, skip applying the global world transform matrix.\n   */\n  setContextTransform(transform, roundPixels, localResolution, skipGlobalTransform) {\n    const globalTransform = skipGlobalTransform ? Matrix.IDENTITY : this._renderer.globalUniforms.globalUniformData?.worldTransformMatrix || Matrix.IDENTITY;\n    let mat = tempMatrix;\n    mat.copyFrom(globalTransform);\n    mat.append(transform);\n    const proj = this._projTransform;\n    const contextResolution = this.activeResolution;\n    localResolution = localResolution || contextResolution;\n    if (proj) {\n      const finalMat = Matrix.shared;\n      finalMat.copyFrom(mat);\n      finalMat.prepend(proj);\n      mat = finalMat;\n    }\n    if (roundPixels) {\n      this.activeContext.setTransform(\n        mat.a * localResolution,\n        mat.b * localResolution,\n        mat.c * localResolution,\n        mat.d * localResolution,\n        mat.tx * contextResolution | 0,\n        mat.ty * contextResolution | 0\n      );\n    } else {\n      this.activeContext.setTransform(\n        mat.a * localResolution,\n        mat.b * localResolution,\n        mat.c * localResolution,\n        mat.d * localResolution,\n        mat.tx * contextResolution,\n        mat.ty * contextResolution\n      );\n    }\n  }\n  /**\n   * Clears the current render target, optionally filling with a color.\n   * @param clearColor - Color to fill after clearing.\n   * @param alpha - Alpha override for the clear color.\n   */\n  clear(clearColor, alpha) {\n    const context = this.activeContext;\n    const renderer = this._renderer;\n    context.clearRect(0, 0, renderer.width, renderer.height);\n    if (clearColor) {\n      const color = Color.shared.setValue(clearColor);\n      context.globalAlpha = alpha ?? color.alpha;\n      context.fillStyle = color.toHex();\n      context.fillRect(0, 0, renderer.width, renderer.height);\n      context.globalAlpha = 1;\n    }\n  }\n  /**\n   * Sets the active blend mode.\n   * @param blendMode - Pixi blend mode.\n   */\n  setBlendMode(blendMode) {\n    if (this._activeBlendMode === blendMode) return;\n    this._activeBlendMode = blendMode;\n    this._outerBlend = false;\n    const mappedBlend = this.blendModes[blendMode];\n    if (!mappedBlend) {\n      if (!this._warnedBlendModes.has(blendMode)) {\n        console.warn(\n          `CanvasRenderer: blend mode \"${blendMode}\" is not supported in Canvas2D; falling back to \"source-over\".`\n        );\n        this._warnedBlendModes.add(blendMode);\n      }\n      this.activeContext.globalCompositeOperation = \"source-over\";\n      return;\n    }\n    this.activeContext.globalCompositeOperation = mappedBlend;\n  }\n  /** Releases context references. */\n  destroy() {\n    this.rootContext = null;\n    this.activeContext = null;\n    this._warnedBlendModes.clear();\n  }\n}\n/** @ignore */\nCanvasContextSystem.extension = {\n  type: [\n    ExtensionType.CanvasSystem\n  ],\n  name: \"canvasContext\"\n};\n\nexport { CanvasContextSystem };\n//# sourceMappingURL=CanvasContextSystem.mjs.map\n","import { ExtensionType } from '../../../extensions/Extensions.mjs';\n\n\"use strict\";\nclass CanvasLimitsSystem {\n  constructor() {\n    this.maxTextures = 16;\n    this.maxBatchableTextures = 16;\n    this.maxUniformBindings = 0;\n  }\n  init() {\n  }\n}\n/** @ignore */\nCanvasLimitsSystem.extension = {\n  type: [\n    ExtensionType.CanvasSystem\n  ],\n  name: \"limits\"\n};\n\nexport { CanvasLimitsSystem };\n//# sourceMappingURL=CanvasLimitsSystem.mjs.map\n","import { ExtensionType } from '../../../extensions/Extensions.mjs';\nimport { groupD8 } from '../../../maths/matrix/groupD8.mjs';\nimport { Matrix } from '../../../maths/matrix/Matrix.mjs';\nimport { canvasUtils } from '../../../rendering/renderers/canvas/utils/canvasUtils.mjs';\nimport { Texture } from '../../../rendering/renderers/shared/texture/Texture.mjs';\nimport { bgr2rgb } from '../../container/container-mixins/getGlobalMixin.mjs';\nimport { multiplyHexColors } from '../../container/utils/multiplyHexColors.mjs';\nimport { buildLine } from '../shared/buildCommands/buildLine.mjs';\nimport { FillGradient } from '../shared/fill/FillGradient.mjs';\nimport { FillPattern } from '../shared/fill/FillPattern.mjs';\nimport { shapeBuilders } from '../shared/utils/buildContextBatches.mjs';\nimport { generateTextureMatrix } from '../shared/utils/generateTextureFillMatrix.mjs';\n\n\"use strict\";\nconst emptyCanvasStyle = \"#808080\";\nconst tempMatrix = new Matrix();\nconst tempTextureMatrix = new Matrix();\nconst tempGradientMatrix = new Matrix();\nconst tempPatternMatrix = new Matrix();\nfunction fillTriangles(context, vertices, indices) {\n  context.beginPath();\n  for (let i = 0; i < indices.length; i += 3) {\n    const i0 = indices[i] * 2;\n    const i1 = indices[i + 1] * 2;\n    const i2 = indices[i + 2] * 2;\n    context.moveTo(vertices[i0], vertices[i0 + 1]);\n    context.lineTo(vertices[i1], vertices[i1 + 1]);\n    context.lineTo(vertices[i2], vertices[i2 + 1]);\n    context.closePath();\n  }\n  context.fill();\n}\nfunction colorToHex(color) {\n  const clamped = color & 16777215;\n  return `#${clamped.toString(16).padStart(6, \"0\")}`;\n}\nfunction buildRoundedRectPath(context, x, y, width, height, radius) {\n  radius = Math.max(0, Math.min(radius, Math.min(width, height) / 2));\n  context.moveTo(x + radius, y);\n  context.lineTo(x + width - radius, y);\n  context.quadraticCurveTo(x + width, y, x + width, y + radius);\n  context.lineTo(x + width, y + height - radius);\n  context.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n  context.lineTo(x + radius, y + height);\n  context.quadraticCurveTo(x, y + height, x, y + height - radius);\n  context.lineTo(x, y + radius);\n  context.quadraticCurveTo(x, y, x + radius, y);\n}\nfunction buildShapePath(context, shape) {\n  switch (shape.type) {\n    case \"rectangle\": {\n      const rect = shape;\n      context.rect(rect.x, rect.y, rect.width, rect.height);\n      break;\n    }\n    case \"roundedRectangle\": {\n      const rect = shape;\n      buildRoundedRectPath(context, rect.x, rect.y, rect.width, rect.height, rect.radius);\n      break;\n    }\n    case \"circle\": {\n      const circle = shape;\n      context.arc(circle.x, circle.y, circle.radius, 0, Math.PI * 2);\n      break;\n    }\n    case \"ellipse\": {\n      const ellipse = shape;\n      if (context.ellipse) {\n        context.ellipse(ellipse.x, ellipse.y, ellipse.halfWidth, ellipse.halfHeight, 0, 0, Math.PI * 2);\n      } else {\n        context.save();\n        context.translate(ellipse.x, ellipse.y);\n        context.scale(ellipse.halfWidth, ellipse.halfHeight);\n        context.arc(0, 0, 1, 0, Math.PI * 2);\n        context.restore();\n      }\n      break;\n    }\n    case \"triangle\": {\n      const tri = shape;\n      context.moveTo(tri.x, tri.y);\n      context.lineTo(tri.x2, tri.y2);\n      context.lineTo(tri.x3, tri.y3);\n      context.closePath();\n      break;\n    }\n    case \"polygon\":\n    default: {\n      const poly = shape;\n      const points = poly.points;\n      if (!points?.length) break;\n      context.moveTo(points[0], points[1]);\n      for (let i = 2; i < points.length; i += 2) {\n        context.lineTo(points[i], points[i + 1]);\n      }\n      if (poly.closePath) {\n        context.closePath();\n      }\n      break;\n    }\n  }\n}\nfunction addHolePaths(context, holes) {\n  if (!holes?.length) return false;\n  for (let i = 0; i < holes.length; i++) {\n    const hole = holes[i];\n    if (!hole?.shape) continue;\n    const transform = hole.transform;\n    const hasTransform = transform && !transform.isIdentity();\n    if (hasTransform) {\n      context.save();\n      context.transform(transform.a, transform.b, transform.c, transform.d, transform.tx, transform.ty);\n    }\n    buildShapePath(context, hole.shape);\n    if (hasTransform) {\n      context.restore();\n    }\n  }\n  return true;\n}\nfunction getCanvasStyle(style, tint, textureMatrix, currentTransform) {\n  const fill = style.fill;\n  if (fill instanceof FillGradient) {\n    fill.buildGradient();\n    const gradientTexture = fill.texture;\n    if (gradientTexture) {\n      const pattern = canvasUtils.getTintedPattern(gradientTexture, tint);\n      const patternMatrix = textureMatrix ? tempPatternMatrix.copyFrom(textureMatrix).scale(gradientTexture.source.pixelWidth, gradientTexture.source.pixelHeight) : tempPatternMatrix.copyFrom(fill.transform);\n      if (currentTransform && !style.textureSpace) {\n        patternMatrix.append(currentTransform);\n      }\n      canvasUtils.applyPatternTransform(pattern, patternMatrix);\n      return pattern;\n    }\n  }\n  if (fill instanceof FillPattern) {\n    const pattern = canvasUtils.getTintedPattern(fill.texture, tint);\n    canvasUtils.applyPatternTransform(pattern, fill.transform);\n    return pattern;\n  }\n  const texture = style.texture;\n  if (texture && texture !== Texture.WHITE) {\n    if (!texture.source.resource) {\n      return emptyCanvasStyle;\n    }\n    const pattern = canvasUtils.getTintedPattern(texture, tint);\n    const patternMatrix = textureMatrix ? tempPatternMatrix.copyFrom(textureMatrix).scale(texture.source.pixelWidth, texture.source.pixelHeight) : style.matrix;\n    canvasUtils.applyPatternTransform(pattern, patternMatrix);\n    return pattern;\n  }\n  return colorToHex(tint);\n}\nclass CanvasGraphicsAdaptor {\n  constructor() {\n    this.shader = null;\n  }\n  contextChange(renderer) {\n    void renderer;\n  }\n  execute(graphicsPipe, renderable) {\n    const renderer = graphicsPipe.renderer;\n    const contextSystem = renderer.canvasContext;\n    const context = contextSystem.activeContext;\n    const baseTransform = renderable.groupTransform;\n    const globalColor = renderer.globalUniforms.globalUniformData?.worldColor ?? 4294967295;\n    const groupColorAlpha = renderable.groupColorAlpha;\n    const globalAlpha = (globalColor >>> 24 & 255) / 255;\n    const groupAlphaValue = (groupColorAlpha >>> 24 & 255) / 255;\n    const filterAlpha = renderer.filter?.alphaMultiplier ?? 1;\n    const groupAlpha = globalAlpha * groupAlphaValue * filterAlpha;\n    if (groupAlpha <= 0) return;\n    const globalTint = globalColor & 16777215;\n    const groupTintBGR = groupColorAlpha & 16777215;\n    const groupTint = bgr2rgb(multiplyHexColors(groupTintBGR, globalTint));\n    const roundPixels = renderer._roundPixels | renderable._roundPixels;\n    context.save();\n    contextSystem.setContextTransform(baseTransform, roundPixels === 1);\n    contextSystem.setBlendMode(renderable.groupBlendMode);\n    const instructions = renderable.context.instructions;\n    for (let i = 0; i < instructions.length; i++) {\n      const instruction = instructions[i];\n      if (instruction.action === \"texture\") {\n        const data2 = instruction.data;\n        const texture = data2.image;\n        const source = texture ? canvasUtils.getCanvasSource(texture) : null;\n        if (!source) continue;\n        const alpha2 = data2.alpha * groupAlpha;\n        if (alpha2 <= 0) continue;\n        const tint2 = multiplyHexColors(data2.style, groupTint);\n        context.globalAlpha = alpha2;\n        let drawSource = source;\n        if (tint2 !== 16777215) {\n          drawSource = canvasUtils.getTintedCanvas({ texture }, tint2);\n        }\n        const frame = texture.frame;\n        const resolution = texture.source._resolution ?? texture.source.resolution ?? 1;\n        let sx = frame.x * resolution;\n        let sy = frame.y * resolution;\n        const sw = frame.width * resolution;\n        const sh = frame.height * resolution;\n        if (drawSource !== source) {\n          sx = 0;\n          sy = 0;\n        }\n        const transform = data2.transform;\n        const hasTransform = transform && !transform.isIdentity();\n        const rotate = texture.rotate;\n        if (hasTransform || rotate) {\n          tempMatrix.copyFrom(baseTransform);\n          if (hasTransform) {\n            tempMatrix.append(transform);\n          }\n          if (rotate) {\n            groupD8.matrixAppendRotationInv(tempMatrix, rotate, data2.dx, data2.dy, data2.dw, data2.dh);\n          }\n          contextSystem.setContextTransform(tempMatrix, roundPixels === 1);\n        } else {\n          contextSystem.setContextTransform(baseTransform, roundPixels === 1);\n        }\n        context.drawImage(\n          drawSource,\n          sx,\n          sy,\n          drawSource === source ? sw : drawSource.width,\n          drawSource === source ? sh : drawSource.height,\n          rotate ? 0 : data2.dx,\n          rotate ? 0 : data2.dy,\n          data2.dw,\n          data2.dh\n        );\n        if (hasTransform || rotate) {\n          contextSystem.setContextTransform(baseTransform, roundPixels === 1);\n        }\n        continue;\n      }\n      const data = instruction.data;\n      const shapePath = data?.path?.shapePath;\n      if (!shapePath?.shapePrimitives?.length) continue;\n      const style = data.style;\n      const tint = multiplyHexColors(style.color, groupTint);\n      const alpha = style.alpha * groupAlpha;\n      if (alpha <= 0) continue;\n      const isStroke = instruction.action === \"stroke\";\n      context.globalAlpha = alpha;\n      if (isStroke) {\n        const strokeStyle = style;\n        context.lineWidth = strokeStyle.width;\n        context.lineCap = strokeStyle.cap;\n        context.lineJoin = strokeStyle.join;\n        context.miterLimit = strokeStyle.miterLimit;\n      }\n      const shapePrimitives = shapePath.shapePrimitives;\n      if (!isStroke && data.hole?.shapePath?.shapePrimitives?.length) {\n        const lastShape = shapePrimitives[shapePrimitives.length - 1];\n        lastShape.holes = data.hole.shapePath.shapePrimitives;\n      }\n      for (let j = 0; j < shapePrimitives.length; j++) {\n        const primitive = shapePrimitives[j];\n        if (!primitive?.shape) continue;\n        const transform = primitive.transform;\n        const hasTransform = transform && !transform.isIdentity();\n        const hasTexture = style.texture && style.texture !== Texture.WHITE;\n        const textureTransform = style.textureSpace === \"global\" ? transform : null;\n        const textureMatrix = hasTexture ? generateTextureMatrix(tempTextureMatrix, style, primitive.shape, textureTransform) : null;\n        const currentTransform = hasTransform ? tempGradientMatrix.copyFrom(baseTransform).append(transform) : baseTransform;\n        const canvasStyle = getCanvasStyle(\n          style,\n          tint,\n          textureMatrix,\n          currentTransform\n        );\n        if (hasTransform) {\n          context.save();\n          context.transform(transform.a, transform.b, transform.c, transform.d, transform.tx, transform.ty);\n        }\n        if (isStroke) {\n          const strokeStyle = style;\n          const useStrokeGeometry = strokeStyle.alignment !== 0.5 && !strokeStyle.pixelLine;\n          if (useStrokeGeometry) {\n            const points = [];\n            const vertices = [];\n            const indices = [];\n            const shapeBuilder = shapeBuilders[primitive.shape.type];\n            if (shapeBuilder?.build(primitive.shape, points)) {\n              const close = primitive.shape.closePath ?? true;\n              buildLine(points, strokeStyle, false, close, vertices, indices);\n              context.fillStyle = canvasStyle;\n              fillTriangles(context, vertices, indices);\n            } else {\n              context.strokeStyle = canvasStyle;\n              context.beginPath();\n              buildShapePath(context, primitive.shape);\n              context.stroke();\n            }\n          } else {\n            context.strokeStyle = canvasStyle;\n            context.beginPath();\n            buildShapePath(context, primitive.shape);\n            context.stroke();\n          }\n        } else {\n          context.fillStyle = canvasStyle;\n          context.beginPath();\n          buildShapePath(context, primitive.shape);\n          const hasHoles = addHolePaths(context, primitive.holes);\n          if (hasHoles) {\n            context.fill(\"evenodd\");\n          } else {\n            context.fill();\n          }\n        }\n        if (hasTransform) {\n          context.restore();\n        }\n      }\n    }\n    context.restore();\n  }\n  destroy() {\n    this.shader = null;\n  }\n}\n/** @ignore */\nCanvasGraphicsAdaptor.extension = {\n  type: [\n    ExtensionType.CanvasPipesAdaptor\n  ],\n  name: \"graphics\"\n};\n\nexport { CanvasGraphicsAdaptor };\n//# sourceMappingURL=CanvasGraphicsAdaptor.mjs.map\n","import { Color } from '../../../../color/Color.mjs';\nimport { DOMAdapter } from '../../../../environment/adapter.mjs';\nimport { CanvasSource } from '../../shared/texture/sources/CanvasSource.mjs';\n\n\"use strict\";\nclass CanvasRenderTargetAdaptor {\n  /**\n   * Initializes the adaptor.\n   * @param renderer - Canvas renderer instance.\n   * @param renderTargetSystem - The render target system.\n   * @advanced\n   */\n  init(renderer, renderTargetSystem) {\n    this._renderer = renderer;\n    this._renderTargetSystem = renderTargetSystem;\n  }\n  /**\n   * Creates a GPU render target for canvas.\n   * @param renderTarget - Render target to initialize.\n   * @advanced\n   */\n  initGpuRenderTarget(renderTarget) {\n    const colorTexture = renderTarget.colorTexture;\n    const { canvas, context } = this._ensureCanvas(colorTexture);\n    return {\n      canvas,\n      context,\n      width: canvas.width,\n      height: canvas.height\n    };\n  }\n  /**\n   * Resizes the backing canvas for a render target.\n   * @param renderTarget - Render target to resize.\n   * @advanced\n   */\n  resizeGpuRenderTarget(renderTarget) {\n    const colorTexture = renderTarget.colorTexture;\n    const { canvas } = this._ensureCanvas(colorTexture);\n    canvas.width = renderTarget.pixelWidth;\n    canvas.height = renderTarget.pixelHeight;\n  }\n  /**\n   * Starts a render pass on the canvas target.\n   * @param renderTarget - Target to render to.\n   * @param clear - Clear mode.\n   * @param clearColor - Optional clear color.\n   * @param viewport - Optional viewport.\n   * @advanced\n   */\n  startRenderPass(renderTarget, clear, clearColor, viewport) {\n    const gpuRenderTarget = this._renderTargetSystem.getGpuRenderTarget(renderTarget);\n    this._renderer.canvasContext.activeContext = gpuRenderTarget.context;\n    this._renderer.canvasContext.activeResolution = renderTarget.resolution;\n    if (clear) {\n      this.clear(renderTarget, clear, clearColor, viewport);\n    }\n  }\n  /**\n   * Clears the render target.\n   * @param renderTarget - Target to clear.\n   * @param _clear - Clear mode (unused).\n   * @param clearColor - Optional clear color.\n   * @param viewport - Optional viewport rectangle.\n   * @advanced\n   */\n  clear(renderTarget, _clear, clearColor, viewport) {\n    const gpuRenderTarget = this._renderTargetSystem.getGpuRenderTarget(renderTarget);\n    const context = gpuRenderTarget.context;\n    const bounds = viewport || { x: 0, y: 0, width: renderTarget.pixelWidth, height: renderTarget.pixelHeight };\n    context.setTransform(1, 0, 0, 1, 0, 0);\n    context.clearRect(bounds.x, bounds.y, bounds.width, bounds.height);\n    if (clearColor) {\n      const color = Color.shared.setValue(clearColor);\n      if (color.alpha > 0) {\n        context.globalAlpha = color.alpha;\n        context.fillStyle = color.toHex();\n        context.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);\n        context.globalAlpha = 1;\n      }\n    }\n  }\n  /**\n   * Finishes the render pass (no-op for canvas).\n   * @advanced\n   */\n  finishRenderPass() {\n  }\n  /**\n   * Copies a render target into a texture source.\n   * @param {RenderTarget} sourceRenderSurfaceTexture - Source render target.\n   * @param {Texture} destinationTexture - Destination texture.\n   * @param {object} originSrc - Source origin.\n   * @param {number} originSrc.x - Source x origin.\n   * @param {number} originSrc.y - Source y origin.\n   * @param {object} size - Copy size.\n   * @param {number} size.width - Copy width.\n   * @param {number} size.height - Copy height.\n   * @param {object} [originDest] - Destination origin.\n   * @param {number} originDest.x - Destination x origin.\n   * @param {number} originDest.y - Destination y origin.\n   * @advanced\n   */\n  copyToTexture(sourceRenderSurfaceTexture, destinationTexture, originSrc, size, originDest) {\n    const sourceGpuTarget = this._renderTargetSystem.getGpuRenderTarget(sourceRenderSurfaceTexture);\n    const sourceCanvas = sourceGpuTarget.canvas;\n    const destSource = destinationTexture.source;\n    const { context } = this._ensureCanvas(destSource);\n    const dx = originDest?.x ?? 0;\n    const dy = originDest?.y ?? 0;\n    context.drawImage(\n      sourceCanvas,\n      originSrc.x,\n      originSrc.y,\n      size.width,\n      size.height,\n      dx,\n      dy,\n      size.width,\n      size.height\n    );\n    destSource.update();\n    return destinationTexture;\n  }\n  /**\n   * Destroys a GPU render target (no-op for canvas).\n   * @param _gpuRenderTarget - Target to destroy.\n   * @advanced\n   */\n  destroyGpuRenderTarget(_gpuRenderTarget) {\n  }\n  _ensureCanvas(source) {\n    let canvas = source.resource;\n    if (!canvas || !CanvasSource.test(canvas)) {\n      canvas = DOMAdapter.get().createCanvas(source.pixelWidth, source.pixelHeight);\n      source.resource = canvas;\n    }\n    if (canvas.width !== source.pixelWidth || canvas.height !== source.pixelHeight) {\n      canvas.width = source.pixelWidth;\n      canvas.height = source.pixelHeight;\n    }\n    const context = canvas.getContext(\"2d\");\n    return { canvas, context };\n  }\n}\n\nexport { CanvasRenderTargetAdaptor };\n//# sourceMappingURL=CanvasRenderTargetAdaptor.mjs.map\n","import { ExtensionType } from '../../../../extensions/Extensions.mjs';\nimport { RenderTargetSystem } from '../../shared/renderTarget/RenderTargetSystem.mjs';\nimport { CanvasRenderTargetAdaptor } from './CanvasRenderTargetAdaptor.mjs';\n\n\"use strict\";\nclass CanvasRenderTargetSystem extends RenderTargetSystem {\n  constructor(renderer) {\n    super(renderer);\n    this.adaptor = new CanvasRenderTargetAdaptor();\n    this.adaptor.init(renderer, this);\n  }\n}\n/** @ignore */\nCanvasRenderTargetSystem.extension = {\n  type: [ExtensionType.CanvasSystem],\n  name: \"renderTarget\"\n};\n\nexport { CanvasRenderTargetSystem };\n//# sourceMappingURL=CanvasRenderTargetSystem.mjs.map\n","import { DOMAdapter } from '../../../../environment/adapter.mjs';\nimport { ExtensionType } from '../../../../extensions/Extensions.mjs';\nimport { canvasUtils } from '../utils/canvasUtils.mjs';\n\n\"use strict\";\nclass CanvasTextureSystem {\n  /**\n   * @param renderer - The owning CanvasRenderer.\n   */\n  constructor(renderer) {\n    void renderer;\n  }\n  /** Initializes the system (no-op for canvas). */\n  init() {\n  }\n  /**\n   * Initializes a texture source (no-op for canvas).\n   * @param _source - Texture source.\n   */\n  initSource(_source) {\n  }\n  /**\n   * Creates a canvas containing the texture's frame.\n   * @param texture - Texture to render.\n   */\n  generateCanvas(texture) {\n    const canvas = DOMAdapter.get().createCanvas();\n    const context = canvas.getContext(\"2d\");\n    const source = canvasUtils.getCanvasSource(texture);\n    if (!source) {\n      return canvas;\n    }\n    const frame = texture.frame;\n    const resolution = texture.source._resolution ?? texture.source.resolution ?? 1;\n    const sx = frame.x * resolution;\n    const sy = frame.y * resolution;\n    const sw = frame.width * resolution;\n    const sh = frame.height * resolution;\n    canvas.width = Math.ceil(sw);\n    canvas.height = Math.ceil(sh);\n    context.drawImage(\n      source,\n      sx,\n      sy,\n      sw,\n      sh,\n      0,\n      0,\n      sw,\n      sh\n    );\n    return canvas;\n  }\n  /**\n   * Reads pixel data from a texture.\n   * @param texture - Texture to read.\n   */\n  getPixels(texture) {\n    const canvas = this.generateCanvas(texture);\n    const context = canvas.getContext(\"2d\", { willReadFrequently: true });\n    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n    return {\n      pixels: imageData.data,\n      width: canvas.width,\n      height: canvas.height\n    };\n  }\n  /** Destroys the system (no-op for canvas). */\n  destroy() {\n  }\n}\n/** @ignore */\nCanvasTextureSystem.extension = {\n  type: [\n    ExtensionType.CanvasSystem\n  ],\n  name: \"texture\"\n};\n\nexport { CanvasTextureSystem };\n//# sourceMappingURL=CanvasTextureSystem.mjs.map\n","import { extensions, ExtensionType } from '../../../extensions/Extensions.mjs';\nimport { CustomRenderPipe } from '../../../scene/container/CustomRenderPipe.mjs';\nimport { RenderGroupPipe } from '../../../scene/container/RenderGroupPipe.mjs';\nimport { CanvasGraphicsAdaptor } from '../../../scene/graphics/canvas/CanvasGraphicsAdaptor.mjs';\nimport { SpritePipe } from '../../../scene/sprite/SpritePipe.mjs';\nimport { CanvasBatchAdaptor } from '../../batcher/canvas/CanvasBatchAdaptor.mjs';\nimport { BatcherPipe } from '../../batcher/shared/BatcherPipe.mjs';\nimport { AlphaMaskPipe } from '../../mask/alpha/AlphaMaskPipe.mjs';\nimport { CanvasColorMaskPipe } from '../../mask/color/CanvasColorMaskPipe.mjs';\nimport { CanvasStencilMaskPipe } from '../../mask/stencil/CanvasStencilMaskPipe.mjs';\nimport { BlendModePipe } from '../shared/blendModes/BlendModePipe.mjs';\nimport { AbstractRenderer } from '../shared/system/AbstractRenderer.mjs';\nimport { SharedSystems } from '../shared/system/SharedSystems.mjs';\nimport { RendererType } from '../types.mjs';\nimport { CanvasContextSystem } from './CanvasContextSystem.mjs';\nimport { CanvasLimitsSystem } from './CanvasLimitsSystem.mjs';\nimport { CanvasRenderTargetSystem } from './renderTarget/CanvasRenderTargetSystem.mjs';\nimport { CanvasTextureSystem } from './texture/CanvasTextureSystem.mjs';\n\n\"use strict\";\nconst DefaultCanvasSystems = [\n  ...SharedSystems,\n  CanvasContextSystem,\n  CanvasLimitsSystem,\n  CanvasTextureSystem,\n  CanvasRenderTargetSystem\n];\nconst DefaultCanvasPipes = [\n  BlendModePipe,\n  BatcherPipe,\n  SpritePipe,\n  RenderGroupPipe,\n  AlphaMaskPipe,\n  CanvasStencilMaskPipe,\n  CanvasColorMaskPipe,\n  CustomRenderPipe\n];\nconst DefaultCanvasAdapters = [\n  CanvasBatchAdaptor,\n  CanvasGraphicsAdaptor\n];\nconst systems = [];\nconst renderPipes = [];\nconst renderPipeAdaptors = [];\nextensions.handleByNamedList(ExtensionType.CanvasSystem, systems);\nextensions.handleByNamedList(ExtensionType.CanvasPipes, renderPipes);\nextensions.handleByNamedList(ExtensionType.CanvasPipesAdaptor, renderPipeAdaptors);\nextensions.add(...DefaultCanvasSystems, ...DefaultCanvasPipes, ...DefaultCanvasAdapters);\nclass CanvasRenderer extends AbstractRenderer {\n  constructor() {\n    const systemConfig = {\n      name: \"canvas\",\n      type: RendererType.CANVAS,\n      systems,\n      renderPipes,\n      renderPipeAdaptors\n    };\n    super(systemConfig);\n  }\n}\n\nexport { CanvasRenderer };\n//# sourceMappingURL=CanvasRenderer.mjs.map\n"],"names":["canUseNewCanvasBlendModesValue","createColoredCanvas","color","canvas","DOMAdapter","context","canUseNewCanvasBlendModes","magenta","yellow","imageData","data","canvasUtils","texture","source","resource","isPMA","resourceWidth","resourceHeight","needsResize","cached","bytes","i","a","alphaInv","sprite","stringColor","Color","cache","cachedCanvas","resourceId","pattern","matrix","invert","patternAny","DOMMatrixCtor","domMatrix","crop","resolution","rotate","isVertical","groupD8","outWidth","outHeight","r","g","b","srcWidth","srcHeight","inv","c","d","tx","ty","_CanvasBatchAdaptor","addressModeU","addressModeV","repeatU","repeatV","batchPipe","geometry","shader","batch","elements","renderer","contextSystem","element","quad","textureStyle","smoothProperty","shouldSmooth","globalColor","argb","globalAlpha","quadAlpha","filterAlpha","alpha","globalTint","quadTint","tint","bgr2rgb","multiplyHexColors","frame","repeat","isFromCachedRenderGroup","sx","sy","sw","sh","bounds","isRootTarget","dx","dy","dw","dh","uvs","uvMin","uvMax","needsRepeat","applyRotateTransform","drawX","drawY","drawW","drawH","patternSource","canTint","fitsFrame","denomX","denomY","invDx","invDy","pixelWidth","pixelHeight","processedSource","isProcessed","Matrix","ExtensionType","CanvasBatchAdaptor","CanvasColorMaskPipe","mask","_container","instructionSet","colorStack","currentColor","_mask","_instruction","buildRoundedRectPath","x","y","width","height","radius","buildShapePath","shape","rect","circle","ellipse","tri","poly","points","addHolePaths","holes","hole","transform","hasTransform","CanvasStencilMaskPipe","instruction","canvasRenderer","maskContainer","Graphics","graphics","instructions","drewPath","hasHoles","instructionData","action","shapePath","shapePrimitives","j","primitive","key","message","warn","FALLBACK_BLEND","mapCanvasBlendModesToPixi","supportsAdvanced","map","tempMatrix","CanvasContextSystem","rc","roundPixels","localResolution","skipGlobalTransform","globalTransform","mat","proj","contextResolution","finalMat","clearColor","blendMode","mappedBlend","CanvasLimitsSystem","emptyCanvasStyle","tempTextureMatrix","tempGradientMatrix","tempPatternMatrix","fillTriangles","vertices","indices","i0","i1","i2","colorToHex","getCanvasStyle","style","textureMatrix","currentTransform","fill","FillGradient","gradientTexture","patternMatrix","FillPattern","Texture","CanvasGraphicsAdaptor","graphicsPipe","renderable","baseTransform","groupColorAlpha","groupAlphaValue","groupAlpha","groupTintBGR","groupTint","data2","alpha2","tint2","drawSource","isStroke","strokeStyle","lastShape","hasTexture","textureTransform","generateTextureMatrix","canvasStyle","shapeBuilders","close","buildLine","CanvasRenderTargetAdaptor","renderTargetSystem","renderTarget","colorTexture","clear","viewport","gpuRenderTarget","_clear","sourceRenderSurfaceTexture","destinationTexture","originSrc","size","originDest","sourceCanvas","destSource","_gpuRenderTarget","CanvasSource","CanvasRenderTargetSystem","RenderTargetSystem","CanvasTextureSystem","_source","DefaultCanvasSystems","SharedSystems","DefaultCanvasPipes","BlendModePipe","BatcherPipe","SpritePipe","RenderGroupPipe","AlphaMaskPipe","CustomRenderPipe","DefaultCanvasAdapters","systems","renderPipes","renderPipeAdaptors","extensions","CanvasRenderer","AbstractRenderer","systemConfig","RendererType"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12]}